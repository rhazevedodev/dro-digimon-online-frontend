# üê£ Teste de Chocagem (Eclos√£o) de Digitama

## üéØ Objetivo
Validar o fluxo de **chocagem da Digitama** previamente selecionada pelo jogador, garantindo que:
- Somente jogadores com uma Digitama selecionada possam executar a eclos√£o;
- A Digitama seja marcada como ‚Äúchocada‚Äù (`digitamaChocada = true`);
- Um novo **Digimon inicial** seja criado e vinculado ao jogador;
- A resposta da API contenha os dados do Digimon rec√©m-criado.

---

## üß© Pr√©-condi√ß√µes
- Jogador autenticado com **token JWT v√°lido**;
- Jogador **j√° possui uma Digitama selecionada** (`digitamaSelecionada = true`);
- `digitamaChocada = false` no estado atual;
- Aplica√ß√£o em execu√ß√£o local (`http://localhost:8080`);
- Postman ou Insomnia configurado.

---

## ‚öôÔ∏è Passos de Teste

### 1Ô∏è‚É£ Verificar estado atual da Digitama

**Descri√ß√£o:**  
Antes de chocar, verificar se a Digitama est√° marcada como selecionada, mas ainda n√£o chocada.

**Curl de teste:**
```bash
curl --request GET \
  --url http://localhost:8080/digitamas/estado \
  --header 'Authorization: Bearer <TOKEN_DO_USUARIO>'
```

**Resultado Esperado**
```json
{
	"id": 1,
	"digitamaSelecionada": true,
	"digitamaIdSelecionada": 1,
	"digitamaChocada": false,
	"ultimoUpdate": "2025-11-16T15:49:45.565872"
}
```

**Valida√ß√µes:**

- ‚úÖ Deve retornar status HTTP 200 OK;
- ‚úÖ A Digitama est√° selecionada (digitamaSelecionada = true);
- ‚úÖ Ainda n√£o est√° chocada (digitamaChocada = false);
- ‚úÖ O digitamaIdSelecionada deve corresponder ao ovo escolhido anteriormente.

### 2Ô∏è‚É£ Executar a chocagem (eclos√£o)

**Descri√ß√£o:**  
Enviar a requisi√ß√£o que realiza o ‚Äúchocar‚Äù da Digitama e cria o primeiro Digimon.

**Curl de teste:**
```bash
curl --request POST \
  --url http://localhost:8080/digitamas/chocar \
  --header 'Authorization: Bearer <TOKEN_DO_USUARIO>' \
  --header 'Content-Type: application/json' \
  --header 'User-Agent: insomnia/11.6.2' \
  --cookie JSESSIONID=0A9891EFA77593692330059A7F822288 \
  --data '{
	"digitamaId":"6"
}'
```

**Resultado Esperado (HTTP 200 OK)**
```json
{
	"digimonId": 1,
	"nome": "Botamon",
	"imagem": "../images/digimons/baby1/botamon.jpg",
	"tipo": "DATA",
	"elemento": "NEUTRAL",
	"personalidade": "LIVELY",
	"ivs": {
		"total": 0,
		"def": 100,
		"spd": 75,
		"hp": 66,
		"atk": 26,
		"int": 68
	},
	"level": 1
}
```

**Valida√ß√µes:**

- ‚úÖ Deve retornar status HTTP 200 OK;
- ‚úÖ O campo digitamaChocada deve ser atualizado para true;
- ‚úÖ Um novo registro de Digimon √© criado no banco, vinculado ao jogador;
- ‚úÖ O nome e o est√°gio do Digimon correspondem √† Digitama escolhida (ex: ‚ÄúDigitama Verde‚Äù ‚Üí ‚ÄúBotamon‚Äù).

### 3Ô∏è‚É£ Verificar atualiza√ß√£o no banco

Verifica√ß√£o manual no banco de dados:

 ``` sql
SELECT id, digitama_chocada, digitama_id_selecionada
FROM estado_jogo
WHERE jogador_id = 1;
 ```

 **Esperado**

| id | digitama_chocada | digitama_id_selecionada |
| -- | ---------------- | ----------------------- |
| 1  | true             | 1                       |

E confirmar o Digimon criado:

 ``` sql
SELECT id, nome, estagio, nivel, jogador_id
FROM digimon
WHERE jogador_id = 1;

 ```

  **Esperado**

| id | nome    | estagio | nivel | jogador_id |
| -- | ------- | ------- | ----- | ---------- |
| 7  | Botamon | Baby I  | 1     | 1          |


### 4Ô∏è‚É£ Tentativa de chocar novamente (caso negativo)

**Descri√ß√£o:**  
Validar que o jogador n√£o pode chocar novamente uma Digitama j√° eclodida.

**Curl de teste:**
```bash
curl --request POST \
  --url http://localhost:8080/digitamas/chocar \
  --header 'Authorization: Bearer <TOKEN_DO_USUARIO>' \
  --header 'Content-Type: application/json' \
  --header 'User-Agent: insomnia/11.6.2' \
  --cookie JSESSIONID=0A9891EFA77593692330059A7F822288 \
  --data '{
	"digitamaId":"6"
}'
```

**Resultado Esperado (HTTP 400 Bad Request)**
```json
{
	"timestamp": "2025-11-16T23:02:24.971956700Z",
	"status": 400,
	"error": "Erro interno",
	"message": "O jogador j√° possui uma Digitama chocada."
}
```

**Valida√ß√µes:**

- ‚úÖ O backend bloqueia m√∫ltiplas eclos√µes;
- ‚úÖ Nenhum novo Digimon √© criado no banco;
- ‚úÖ Mensagem de erro clara e coerente;
- ‚úÖ Log de auditoria pode ser registrado (futuro).

## üßæ P√≥s-condi√ß√µes
- A Digitama do jogador est√° marcada como digitamaChocada = true;
- Um novo Digimon foi criado e vinculado corretamente ao jogador;
- O jogador n√£o pode repetir o processo de chocagem;
- O estado do jogo est√° pronto para os pr√≥ximos testes (menu inicial / interface principal do Digimon).

## ‚ö†Ô∏è Observa√ß√µes
- O fluxo de chocagem s√≥ pode ocorrer uma vez por Digitama;
- O sistema deve garantir que apenas jogadores com uma Digitama selecionada possam executar o POST /chocar;
- Erros esperados:
```pgsql
400 BAD REQUEST ‚Üí O jogador j√° possui uma Digitama chocada.
403 FORBIDDEN ‚Üí Nenhuma Digitama selecionada.
```