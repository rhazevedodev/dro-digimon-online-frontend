# ü•ö Teste de Sele√ß√£o de Digitama

## üéØ Objetivo
Validar o fluxo de **sele√ß√£o inicial de Digitama** por parte do jogador rec√©m-criado, garantindo que:
- O jogador s√≥ possa selecionar **uma Digitama** por vez;
- O estado do jogador seja atualizado corretamente no banco (`digitamaSelecionada = true`);
- O retorno da API traga confirma√ß√£o da escolha e os dados da Digitama.

---

## üß© Pr√©-condi√ß√µes
- Usu√°rio cadastrado e autenticado (token JWT v√°lido obtido via `/auth/login`);
- Jogador rec√©m-criado, ainda **sem Digitama selecionada** (`digitamaSelecionada = false`);
- Aplica√ß√£o em execu√ß√£o local (`http://localhost:8080`);
- Postman ou Insomnia configurado.

---

## ‚öôÔ∏è Passos de Teste

### 1Ô∏è‚É£ Listar Digitamas dispon√≠veis

**Descri√ß√£o:**  
Obter a lista de Digitamas iniciais dispon√≠veis para sele√ß√£o.

**Curl de teste:**
```bash
curl --request GET \
  --url http://localhost:8080/digitamas \
  --header 'User-Agent: insomnia/11.6.1' \
  --cookie JSESSIONID=0A9891EFA77593692330059A7F822288
```

**Resultado Esperado**
```json
[
  {
		"id": 1,
		"nome": "Digitama Verde",
		"imagem": "../images/digimons/digitamas/digitama1.jpg",
		"possiveis": [
			"Botamon",
			"Punimon"
		]
  },
  {
		"id": 2,
		"nome": "Digitama Azul",
		"imagem": "../images/digimons/digitamas/digitama2.jpeg",
		"possiveis": [
			"Yuramon",
			"Poyomon"
		]
  }
]
```

**Valida√ß√µes:**

- ‚úÖ Deve retornar status HTTP 200 OK.
- ‚úÖ Deve listar todas as Digitamas iniciais cadastradas;
- ‚úÖ O username retornado deve corresponder ao usu√°rio logado;
- ‚úÖ Nenhum campo essencial (id, nome, imagem, possiveis) deve vir nulo.

### 2Ô∏è‚É£ Selecionar uma Digitama

**Descri√ß√£o:**  
Enviar a escolha do jogador informando o ID da Digitama selecionada.

**Curl de teste:**

```bash
curl --request POST \
  --url http://localhost:8080/digitamas/selecionar \
  --header 'Authorization: Bearer <TOKEN_DO_USUARIO>' \
  --header 'Content-Type: application/json' \
  --header 'User-Agent: insomnia/12.0.0' \
  --cookie JSESSIONID=0A9891EFA77593692330059A7F822288 \
  --data '{
	"digitamaId": 1
}'
```

**Resultado Esperado (HTTP 200 OK)**
```json
{
	"mensagem": "Digitama selecionada com sucesso!",
	"digitama": {
		"id": 1,
		"nome": "Digitama Verde",
		"imagem": "../images/digimons/digitamas/digitama1.jpg"
	},
	"jogador": {
		"id": 1,
		"digitamaSelecionada": true,
		"digitamaIdSelecionada": 1
	}
}
```

**Valida√ß√µes:**

- ‚úÖ Deve retornar status HTTP 200 OK.
- ‚úÖ O jogador passa a ter digitamaSelecionada = true;
- ‚úÖ O campo digitamaIdSelecionada no banco reflete a escolha.

### 3Ô∏è‚É£ Verificar atualiza√ß√£o no banco

Verifica√ß√£o manual no banco de dados:

 ``` sql
SELECT id, digitama_selecionada, digitama_id_selecionada
FROM estado_jogo
WHERE jogador_id = 1
 ```

### 4Ô∏è‚É£ Tentar selecionar novamente (caso negativo)

**Descri√ß√£o:**  
Validar que o jogador n√£o pode selecionar outra Digitama depois de j√° ter escolhido uma.

```bash
curl --request POST \
  --url http://localhost:8080/digitamas/selecionar \
  --header 'Authorization: Bearer <TOKEN_DO_USUARIO>' \
  --header 'Content-Type: application/json' \
  --header 'User-Agent: insomnia/12.0.0' \
  --cookie JSESSIONID=0A9891EFA77593692330059A7F822288 \
  --data '{
	"digitamaId": 1
}'
```

**Resultado Esperado (HTTP 400 Bad Request)**
```json
{
	"timestamp": "2025-11-16T19:46:20.410110Z",
	"status": 400,
	"error": "Erro interno",
	"message": "O jogador j√° possui uma Digitama selecionada."
}
```

**Valida√ß√µes:**

- ‚úÖ O backend bloqueia m√∫ltiplas sele√ß√µes;
- ‚úÖ Nenhum dado do jogador √© alterado ap√≥s a tentativa;
- ‚úÖ Log de erro ou auditoria √© registrado (se implementado). //ainda nao esta sendo feito

## üßæ P√≥s-condi√ß√µes
- O jogador possui digitamaSelecionada = true;
- O campo digitamaIdSelecionada cont√©m o ID da Digitama escolhida;
- O fluxo de evolu√ß√£o (eclos√£o) pode ser iniciado a partir desse estado.

## ‚ö†Ô∏è Observa√ß√µes
- Esse fluxo s√≥ pode ser executado uma vez por jogador;
- A API deve retornar erro consistente se chamada novamente;
- Testes futuros dependem do estado resultante (digitamaSelecionada = true).