# üîê Teste de Login e Autentica√ß√£o JWT

## üéØ Objetivo
Validar o fluxo de autentica√ß√£o de um **usu√°rio previamente cadastrado**, garantindo que o sistema:
- Retorne um **token JWT v√°lido**;
- Permita o **acesso a endpoints protegidos** com o token recebido;
- Rejeite requisi√ß√µes sem token ou com token inv√°lido/expirado.

---

## üß© Pr√©-condi√ß√µes
- Usu√°rio previamente cadastrado (ex: `rafael2@teste.com` com senha `123456`);
- Aplica√ß√£o em execu√ß√£o local (`http://localhost:8080`);
- Postman ou Insomnia configurado;
- Banco de dados migrado e consistente (Flyway OK).

---
## ‚öôÔ∏è Passos de Teste

### 1Ô∏è‚É£ Autentica√ß√£o de usu√°rio existente

**Descri√ß√£o:**  
Enviar uma requisi√ß√£o `POST /auth/login` com o e-mail e senha de um usu√°rio v√°lido.

**Curl de teste:**
```bash
curl --request POST \
  --url http://localhost:8080/auth/login \
  --header 'Content-Type: application/json' \
  --header 'User-Agent: insomnia/11.6.1' \
  --cookie JSESSIONID=0A9891EFA77593692330059A7F822288 \
  --data '{
  "username": "rafael",
  "password": "123456"
}'
```

**Resultado Esperado (HTTP 200 OK)**

    ```json
    {
	"token": "eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJyYWZhZWwiLCJpYXQiOjE3NjMxNzMxODYsImV4cCI6MTc2MzI1OTU4Nn0.XQY9AhwCeeUhbijqNCz6_PiT10afbpaXRkHkzJDA6zA",
	"username": "rafael"
    }
    ```
**Valida√ß√µes:**

- ‚úÖ Deve retornar status HTTP 200 OK.
- ‚úÖ O campo token deve conter um JWT v√°lido;
- ‚úÖ O username retornado deve corresponder ao usu√°rio logado;
- ‚úÖ O token deve ser aceito em requisi√ß√µes autenticadas (pr√≥ximo passo).

---

### 2Ô∏è‚É£ Acesso a endpoint protegido com token v√°lido

**Descri√ß√£o:**  
Usar o token obtido no passo anterior para acessar um endpoint protegido, confirmando que o sistema reconhece a autentica√ß√£o.

**Curl de teste:**
```bash
curl --request GET \
  --url http://localhost:8080/digimon \
  --header 'Authorization: Bearer <TOKEN_DO_LOGIN>'
```

**Resultado Esperado (HTTP 200 OK)**
```json
[
  {
    "id": 1,
    "nome": "Agumon",
    "nivel": 5,
    "estagio": "Rookie",
    "ativo": true
  }
]
```

**Valida√ß√µes:**

- ‚úÖ O endpoint responde com dados (lista de Digimons, por exemplo);
- ‚úÖ O token JWT √© aceito e decodificado corretamente pelo backend.

---

### 3Ô∏è‚É£ Tentativa de acesso com token inv√°lido

**Descri√ß√£o:**  
Enviar a mesma requisi√ß√£o, mas com token corrompido ou expirado, para validar a rejei√ß√£o.

**Curl de teste:**
```bash
curl --request GET \
  --url http://localhost:8080/digimon \
  --header 'Authorization: Bearer TOKEN_INVALIDO_EXEMPLO'
```

**Resultado Esperado**
```json
{
  "error": "Token inv√°lido ou expirado",
  "status": 401
}
```

**Valida√ß√µes:**

- ‚úÖ Deve retornar status 401 Unauthorized;
- ‚úÖ Nenhum dado sens√≠vel deve ser retornado;
- ‚úÖ Mensagem de erro deve indicar claramente problema de autentica√ß√£o.

---

### 4Ô∏è‚É£ Tentativa de acesso sem token

**Descri√ß√£o:**  
Enviar requisi√ß√£o ao mesmo endpoint protegido, mas sem o cabe√ßalho Authorization.

**Curl de teste:**
```bash
curl --request GET \
  --url http://localhost:8080/digimon
```

**Resultado Esperado**
```json
{
  "error": "Acesso negado - autentica√ß√£o obrigat√≥ria"
}
```

**Valida√ß√µes:**

- ‚úÖ A requisi√ß√£o deve ser rejeitada;
- ‚úÖ A mensagem deve indicar aus√™ncia de credenciais;
- ‚úÖ O backend deve registrar o evento (log de seguran√ßa).

## üßæ P√≥s-condi√ß√µes
- O token JWT emitido no login √© v√°lido at√© expira√ß√£o (verificar tempo de validade configurado);
- Sess√£o autenticada permite requisi√ß√µes subsequentes;
- Tokens inv√°lidos ou ausentes s√£o corretamente bloqueados.

## ‚ö†Ô∏è Observa√ß√µes
- Teste cobre autentica√ß√£o via JWT e controle de acesso via Spring Security;
- Tempo de expira√ß√£o padr√£o do token: geralmente 2 horas (configur√°vel em propriedades);
- Erros esperados:
```pgsql
401 UNAUTHORIZED ‚Üí token inv√°lido ou expirado.
403 FORBIDDEN ‚Üí aus√™ncia de token.
```